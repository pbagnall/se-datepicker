<!doctype html>
<!--suppress HtmlFormInputWithoutLabel -->
<html lang="en/GB">
<head>
   <title>Popup demo</title>
   <script src='/scripts/main.js'></script>
   <link rel='stylesheet' href='/styles/styles.css' />
   <link rel='stylesheet' href='/popup/demostyles.css' />

   <script type='text/javascript'>
      function toggle(event) {
         const trigger = event.target;
         const popup = document.getElementById("popup"+trigger.id.slice(7));

         if (trigger.textContent === 'Open popup') {
            popup.open();
            popup.addEventListener("close", () => popupClosed(trigger, popup));
            trigger.textContent = 'Close popup'
         } else {
            popup.close();
         }
      }

      function popupClosed(trigger, popup) {
         trigger.textContent = "Open popup";
         popup.removeEventListener("close", popupClosed);
      }

      let idNumber = 1;

      function insertTrigger(title, html, klass, titleclass) {
         const triggerTemplate = document.getElementById('triggerTemplate');
         const triggerInstance = triggerTemplate.content.cloneNode(true);

         const section = triggerInstance.querySelector("section");
         if (titleclass) section.className = titleclass;

         const header = triggerInstance.querySelector("h2");
         header.innerHTML = title;

         const content = triggerInstance.querySelector("div");
         if (html) {
            content.innerHTML = html;
         } else {
            section.removeChild(content);
         }

         const button = triggerInstance.querySelector('section>button');
         button.id = "trigger"+idNumber;
         if (klass) button.className = klass;

         const scripts = document.getElementsByTagName('script');
         const script = scripts[scripts.length-1];
         script.parentElement.insertBefore(triggerInstance, script);
      }

      function insertPopup(direction, klass) {
         const popupTemplate = document.getElementById('popupTemplate');
         const popupInstance = popupTemplate.content.cloneNode(true);
         const popup = popupInstance.querySelector('se-popup');
         popup.id = "popup"+idNumber;
         popup.setAttribute('anchor', "trigger"+idNumber);
         popup.setAttribute('anchor-direction', direction);
         if (klass) popup.className = klass;
         document.body.appendChild(popupInstance);
      }

      function insertTriggerAndPopup(title, html, direction, klass, titleclass) {
         insertTrigger(title, html, klass, titleclass);
         insertPopup(direction, klass);

         idNumber++;
      }

      function setDirection(event) {
         const value = event.target.value;
         const idnum = event.target.name.slice(3);
         const popup = document.getElementById('popup'+idnum);
         popup.setAttribute('anchor-direction', value);
         popup.close();
         toggle({ target: document.getElementById('trigger'+idnum)});
      }
   </script>


   <template id='triggerTemplate'>
      <section>
         <h2>--Title--</h2>
         <div></div>
         <button id='buttonid' onclick='toggle(event)'>Open popup</button>
      </section>
   </template>

   <template id='popupTemplate'>
      <se-popup id='popupid' anchor='buttonid' anchor-direction='se,sw,ne,nw,em,wm'>
         <h2 class='popup'>Popup content</h2>
         <p>
            The popup will automatically size itself to fit the content, unless the content is styled with fixed
            size. This means the size of the popup depends on the position it finally gets. So the position needs
            to be attempted for each possible position.
         </p>
      </se-popup>
   </template>
</head>
<body>
<header>
   <h1>Web Components demonstration</h1>
</header>
<nav>
   <ul>
      <li><a href='/'>Overview</a></li>
      <li><a href='/datepicker/'>Date Picker</a></li>
      <li class='selected'>Popup</li>
      <li><a href='/selection/'>Selection</a></li>
   </ul>
</nav>
<main>
   <demo-subnav>
      <a href='.'>Demo</a>
      <a href='docs.html'>Documentation</a>
      <a href='test.html'>Testing</a>
      <a href='test2.html'>Testing</a>
   </demo-subnav>

   <div>
      <section style='text-align: right;' >
         <h2>Configurable, popup at end of DOM</h2>
         <demo-directionmap id='map1' popup='mapPopup' directions='ne,nm,nw,se,sm,sw,en,em,es,wn,wm,ws'></demo-directionmap>
      </section>
      <section>
         <h2>Popup settings</h2>
         <p>Width: <input name='width' type='number'></p>
         <p>Min Width: <input name='minwidth' type='number'></p>
         <p>Max Width: <input name='maxwidth' type='number'></p>
      </section>
      <section>
         <h2>Configurable, popup sibling of trigger</h2>
         <demo-directionmap id='map2' popup='mapPopup2' directions='ne,nm,nw,se,sm,sw,en,em,es,wn,wm,ws'></demo-directionmap>
         <se-popup class='' id='mapPopup2' anchor='mapSE2' anchor-direction='se,sm,es,em'>
            <h2 class='popup'>Popup content</h2>
            <p>
               The popup will automatically size itself to fit the content, unless the content is styled with fixed
               size. This means the size of the popup depends on the position it finally gets. So the position needs
               to be attempted for each possible position.
            </p>
         </se-popup>
      </section>
   </div>

   <section>
      <details open>
         <summary>Features</summary>
         <ul>
            <li>Automatically positions itself relative to an "anchor" element</li>
            <li>
               Options for where it appears relative to anchor can be set in order of preference, and dependent on
               there being enough space in that direction. The first direction it fits in will be used. If none fit
               it will use the first.
            </li>
            <li>Styleable using CSS custom properties</li>
            <li>Only one popup can be open at a time</li>
            <li>Clicking outside a popup closes the popup</li>
            <li>Fires events when the popup is opened or closed</li>
         </ul>
      </details>
   </section>

   <p style='height: 100px; display: flex; align-items: center;'>
      Scroll down for more popups, for testing positioning when scrolled.
   </p>

   <div>
      <script>insertTriggerAndPopup('With default styling', '', 'se,ne', null, '');</script>

      <section>
         <h2>Used by datepicker</h2>
         <se-datepicker date='today'/>
      </section>

      <div></div>

      <section>
         <h2>With custom styling</h2>
         <button id='trigger101' class='alternate' onclick='toggle(event)'>Open popup</button>
      </section>
      <se-popup id='popup101' anchor='trigger101' anchor-direction='nw' class='alternate'>
         <h2 class='popup'>Popup content</h2>
         <p>
            The popup will automatically size itself to fit the content, unless the content is styled with fixed size
         </p>
      </se-popup>
   </div>
</main>
<se-popup class='' id='mapPopup' anchor='mapSE' anchor-direction='se,sm,es,em'>
   <h2 class='popup'>Popup content</h2>
   <p>
      The popup will automatically size itself to fit the content, unless the content is styled with fixed
      size. This means the size of the popup depends on the position it finally gets. So the position needs
      to be attempted for each possible position.
   </p>
</se-popup>
</body>
</html>
